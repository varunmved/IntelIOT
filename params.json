{"name":"Intel IOT \"Medipal\" Health-Kit","tagline":"","body":"### Intel IOT Health-Kit Thermometer (The Medipal)\r\nI first want to start out by warning you, the reader, that this battle station isn't fully operational. My team \"Medipal\" has been frantically trying to get everything together by our presentation. We're a team of four students and between geographical problems and having no idea what we were doing at times, we've tried our best to put out something to show off.\r\n\r\n### Purpose of this page + Credit where it's due\r\nI'm trying to put together some code so I can walk you through how to make your Intel IOT board serve as a cloud connected thermometer. I'll try to continue to keep updating this page as much as I can. I want to integrate the google maps API so we can really track where the temperatures are varying.\r\n\r\nAlmost all of the credit for figuring this out goes to Jason Everett who made [this](http://blog.ijasoneverett.com/2013/03/a-sample-app-with-node-js-express-and-mongodb-part-1/) wonderful tutorial on how to make an app using node.js, express, and mongoDB. Additionally, I based a lot of my code around [this](https://github.com/gomobile/iotapp-local-temperature) writeup by the brilliant folks at intel. \r\n\r\n### Where do we begin!?\r\nThe first thing you'll want to do is install the aspects of the package that we'll be using.\r\n* You'll first want to download [MongoDB](http://www.mongodb.org/downloads), specifically the 32-bit version for Linux. MongoDB is essentially a NoSQL database which can easily run on multiple platforms. This is great for our project since we're running a 32-bit Yocto-Linux OS. One key thing to note though! USE YOUR EXTERNAL SD CARD. you need a minimum of 2GB, so you really don't want to be running out of space here. If you find difficulty installing it, unzip the contents on your computer and copy the .tar/.gz file onto your sd card. Installing it from there should be fairly easy with the terminal.\r\n\r\n* Next, get express up and running your Edison. [Express](http://expressjs.com/) is a web application framework that runs on top of node.js which will make our lives much easier. Both Jason's tutorial and Intel's github page require express as well. This is another package that can be installed by using npm. In order to install, make sure you're logged in as the root user with elevated permissions. \r\nSimply type in the text below, it's important you add the -generator portion, because otherwise it will keep uninstalling at every instance you try to run your app.\r\n```\r\nnpm install -g express-generator\r\n````\r\n\r\n* Next, get libmraa installed on your board. [Libmraa](https://github.com/intel-iot-devkit/mraa) is what binds the c/c++ libraries to javascript code allowing us to interface with the IO on the board. We'll need this to use our grove-sensors in order to get the temperature. The link has the following instructions as well\r\n```\r\necho \"src mraa-upm http://iotdk.intel.com/repos/1.1/intelgalactic\" > /etc/opkg/mraa-upm.conf\r\nopkg update\r\nopkg install libmraa0\r\n```\r\n* Lastly, you'll need [socket.io] (http://socket.io/download/) which is what intel's example uses as well.Socket.io \"Socket.IO enables real-time bidirectional event-based communication.It works on every platform, browser or device, focusing equally on reliability and speed.\" \r\n\r\n### Let's write some code\r\n* Now that we have everything up and running, let's understand how to program the board.A lot of this code will be similar from both Jason's tutorial and the one on the Intel page I linked above.\r\n\r\n```\r\nmkdir Tempearture\r\ncd EmployeeDB\r\nexpress -c stylus\r\nnpm install -d\r\n\r\n```\r\n* Then cd into the TemperatureDB and look at the package.json and edit it so it looks like this\r\n\r\n```\r\n{\r\n  \"name\": \"application-name\",\r\n  \"version\": \"0.0.1\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"start\": \"node app\"\r\n  },\r\n  \"dependencies\": {\r\n    \"express\": \"3.1.0\",\r\n    \"mongodb\": \">= 0.9.6-7\",\r\n    \"socket.io\":\"latest\"\r\n   }\r\n}\r\n\r\n```\r\n* Now if we type in the following it will set up the mongoDB client\r\n```\r\nnpm install -d\r\n\r\n```\r\n* Let's create the javascript file which will talk to MongoDB.Save this as temperatureprovider.js\r\n```\r\nvar Db = require('mongodb').Db;\r\nvar Connection = require('mongodb').Connection;\r\nvar Server = require('mongodb').Server;\r\nvar BSON = require('mongodb').BSON;\r\nvar ObjectID = require('mongodb').ObjectID;\r\n\r\nTemperatureProvider = function(host, port) {\r\n  this.db= new Db('node-mongo-Temperature', new Server(host, port, {safe: false}, {auto_reconnect: true}, {}));\r\n  this.db.open(function(){});\r\n};\r\n\r\n\r\nTemperatureProvider.prototype.getCollection= function(callback) {\r\n  this.db.collection('Temperatures', function(error, Temperature_collection) {\r\n    if( error ) callback(error);\r\n    else callback(null, Temperature_collection);\r\n  });\r\n};\r\n\r\n//find all Temperatures\r\nTemperatureProvider.prototype.findAll = function(callback) {\r\n    this.getCollection(function(error, Temperature_collection) {\r\n      if( error ) callback(error)\r\n      else {\r\n        Temperature_collection.find().toArray(function(error, results) {\r\n          if( error ) callback(error)\r\n          else callback(null, results)\r\n        });\r\n      }\r\n    });\r\n};\r\n\r\n//save new Temperature\r\nTemperatureProvider.prototype.save = function(Temperatures, callback) {\r\n    this.getCollection(function(error, Temperature_collection) {\r\n      if( error ) callback(error)\r\n      else {\r\n        if( typeof(Temperatures.length)==\"undefined\")\r\n          Temperatures = [Temperatures];\r\n\r\n        for( var i =0;i< Temperatures.length;i++ ) {\r\n          Temperature = Temperatures[i];\r\n          Temperature.created_at = new Date();\r\n        }\r\n\r\n        Temperature_collection.insert(Temperatures, function() {\r\n          callback(null, Temperatures);\r\n        });\r\n      }\r\n    });\r\n};\r\n\r\nexports.TemperatureProvider = TemperatureProvider;\r\n```\r\n* Let's write the app.js. When writing this, we incorporated the socket.io connections in the previous examples. Using this in conjunction with temperatureprovider.js \r\n```\r\n/**\r\n * Module dependencies.\r\n */\r\nvar B = 3975;\r\nvar mraa = require(\"mraa\");\r\n\r\n//GROVE Kit A0 Connector --> Aio(0)\r\nvar myAnalogPin = new mraa.Aio(0);\r\n\r\n/*\r\nFunction: startSensorWatch(socket)\r\nParameters: socket - client communication channel\r\nDescription: Read Temperature Sensor and send temperature in degrees of Fahrenheit every 4 seconds\r\n*/\r\nfunction startSensorWatch(socket) {\r\n    'use strict';\r\n    setInterval(function () {\r\n        var a = myAnalogPin.read();\r\n        console.log(\"Analog Pin (A0) Output: \" + a);\r\n        //console.log(\"Checking....\");\r\n        \r\n        var resistance = (1023 - a) * 10000 / a; //get the resistance of the sensor;\r\n        //console.log(\"Resistance: \"+resistance);\r\n        var celsius_temperature = 1 / (Math.log(resistance / 10000) / B + 1 / 298.15) - 273.15;//convert to temperature via datasheet ;\r\n        //console.log(\"Celsius Temperature \"+celsius_temperature); \r\n        var fahrenheit_temperature = (celsius_temperature * (9 / 5)) + 32;\r\n        console.log(\"Fahrenheit Temperature: \" + fahrenheit_temperature);\r\n        socket.emit(\"message\", fahrenheit_temperature);\r\n    }, 4000);\r\n}\r\n\r\nconsole.log(\"Sample Reading Grove Kit Temperature Sensor\");\r\n\r\n//Create Socket.io server\r\nvar http = require('http');\r\nvar app = http.createServer(function (req, res) {\r\n    'use strict';\r\n    res.writeHead(200, {'Content-Type': 'text/plain'});\r\n    res.end('<h1>Hello world from Intel IoT platform!</h1>');\r\n}).listen(1337);\r\nvar io = require('socket.io')(app);\r\n\r\n//Attach a 'connection' event handler to the server\r\nio.on('connection', function (socket) {\r\n    'use strict';\r\n    console.log('a user connected');\r\n    //Emits an event along with a message\r\n    socket.emit('connected', 'Welcome');\r\n\r\n    //Start watching Sensors connected to Galileo board\r\n    startSensorWatch(socket);\r\n\r\n    //Attach a 'disconnect' event handler to the socket\r\n    socket.on('disconnect', function () {\r\n        console.log('user disconnected');\r\n    });\r\n});\r\n\r\n\r\nvar express = require('express')\r\n  , routes = require('./routes')\r\n  , user = require('./routes/user')\r\n  , http = require('http')\r\n  , path = require('path')\r\n  , TemperatureProvider = require('./temperatureprovider').TemperatureProvider;\r\n\r\nvar app = express();\r\n\r\napp.configure(function(){\r\n  app.set('port', process.env.PORT || 3000);\r\n  app.set('views', __dirname + '/views');\r\n  app.set('view engine', 'jade');\r\n  app.set('view options', {layout: false});\r\n  app.use(express.favicon());\r\n  app.use(express.logger('dev'));\r\n  app.use(express.bodyParser());\r\n  app.use(express.methodOverride());\r\n  app.use(app.router);\r\n  app.use(require('stylus').middleware(__dirname + '/public'));\r\n  app.use(express.static(path.join(__dirname, 'public')));\r\n});\r\n\r\napp.configure('development', function(){\r\n  app.use(express.errorHandler());\r\n});\r\n\r\nvar temperatureProvider= new TemperatureProvider('localhost', 27017);\r\n\r\n//Routes\r\n\r\napp.get('/', function(req, res){\r\n  temperatureProvider.findAll(function(error, emps){\r\n      res.render('index', {\r\n            title: 'Temperatures',\r\n            temperatures:emps\r\n        });\r\n  });\r\n});\r\n\r\napp.get('/temperature/new', function(req, res) {\r\n    res.render('temperature_new', {\r\n        title: 'New Temperature'\r\n    });\r\n});\r\n\r\n//save new temperature\r\napp.post('/temperature/new', function(req, res){\r\n    temperatureProvider.save({\r\n        title: req.param('title'),\r\n        name: req.param('name')\r\n    }, function( error, docs) {\r\n        res.redirect('/')\r\n    });\r\n});\r\n\r\n\r\n\r\napp.listen(3000);\r\n```\r\n### The future\r\n\r\nWe hope to write some kind of front-end for our board, integrating it with google maps api. The idea is to show a temperature and a location with a color coordinated icon revealing the heat.\r\n\r\n### Contact\r\nFeel free to tweet me at [@vved123](https://twitter.com/vved123) if you have any questions about anything on the page here.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}